# =======================================================
# MUSCLEDIA GAMIFICATION SERVICE - SMART CONFIGURATION
# =======================================================
# One config file that works for MVP AND production
# Override with environment variables as needed

server:
  port: ${PORT:8083}

spring:
  application:
    name: muscledia-gamification-service

    # Database - Temporarily disabled for testing
  data:
    mongodb:
      uri: ${MONGODB_URI:mongodb+srv://mongo:NSX2O96ElPhiLPMk@cluster0.dcypj6u.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0&connectTimeoutMS=20000&socketTimeoutMS=20000&maxIdleTimeMS=120000&maxLifeTimeMS=120000}
      database: ${MONGODB_DATABASE:gamification_db}
      auto-index-creation: true

  # Kafka - Optional for events (MVP: disabled, Production: enable with env var)
  kafka:
    bootstrap-servers: ${KAFKA_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      # Producer configuration for reliability and performance:
      acks: all # Guarantees message delivery
      retries: 3 # Number of retries for failed sends
      batch-size: 16384 # Default batch size (16KB)
      linger.ms: 5 # Time to wait before sending a batch
      # Idempotent producer for exactly-once delivery (important for robustness)
      properties:
        enable.idempotence: true
    consumer:
      group-id: ${KAFKA_GROUP:gamification-service}
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.ErrorHandlingDeserializer
      properties:
        spring.json.trusted.packages: "*"
        spring.json.use.type.headers: false
        spring.json.value.default.type: "java.util.Map"

# Security
jwt:
  secret: ${JWT_SECRET:81795ad725b2cadd49d27a60438415588db374020a561ae19cafebeef6339655304975b150867b21d3715e341a49271a75a7dde39776e156af0ddad50f5e6ec3}
  expiration: ${JWT_EXPIRATION:86400000}
  issuer: ${JWT_ISSUER:muscledia-user-service}

# Gamification Settings - MVP defaults, production configurable
gamification:
  # Database control
  mongodb:
    enabled: ${MONGODB_ENABLED:true} # MVP: false for testing, Prod: true

  challenge-templates:
    auto-load: true          # Enable auto-loading on startup
    reload-on-startup: false # Only reload if no templates exist

  # Features (MVP: events disabled for testing without MongoDB)
  events:
    processing:
      enabled: ${EVENTS_ENABLED:true} # Disabled for testing
      batch-size: ${EVENT_BATCH_SIZE:50}
  duplicate:
    consumer:
      enabled: true # Disable the duplicate consumer

  scheduling:
    enabled: ${SCHEDULING_ENABLED:false} # MVP: false, Prod: true
    quest-generation:
      cron: ${QUEST_CRON:0 0 6 * * ?} # 6 AM daily
    leaderboard-refresh:
      cron: ${LEADERBOARD_CRON:0 */30 * * * ?} # Every 30 minutes

# Service Discovery - Optional
eureka:
  client:
    enabled: ${EUREKA_ENABLED:true} # MVP: false, Prod: true
    service-url:
      defaultZone: ${EUREKA_URL:http://localhost:8761/eureka}

# Monitoring
management:
  endpoints:
    web:
      exposure:
        include: ${ACTUATOR_ENDPOINTS:health,info}
  endpoint:
    health:
      show-details: when-authorized
  health:
    redis:
      enabled: ${REDIS_HEALTH_ENABLED:true}

# Logging
logging:
  level:
    com.muscledia.Gamification_service: ${LOG_LEVEL:INFO}
    com.muscledia.Gamification_service.service.ChallengeTemplateLoader: DEBUG
    org.springframework: WARN
    com.muscledia.Gamification_service.event: DEBUG
    org.springframework.kafka: INFO
    org.apache.kafka: WARN
    redis: ${REDIS_LOG_LEVEL:OFF}

# API Documentation - Enabled for testing
springdoc:
  api-docs:
    enabled: ${API_DOCS_ENABLED:true}
    path: /api-docs
  swagger-ui:
    enabled: ${SWAGGER_ENABLED:true}
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha

